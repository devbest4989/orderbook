= form_for(@product, html: { class: 'form-horizontal form-label-left input_mask', 'data-parsley-validate' => '' }) do |f|
  .row
    .col-md-6.col-sm-6.col-xs-12.col-md-offset-3
      - if @product.errors.any? && flash[:last_action] == "update_info"
        .alert.alert-danger.alert-dismissible.fade.in{:role => "alert"}
          %button.close{"aria-label" => "Close", "data-dismiss" => "alert", :type => "button"}
            %span{"aria-hidden" => "true"} ×   
          %h2{'style' => "text-align:center;"}= "There are #{pluralize(@user.errors.count, "error")}."
          %ul
            - @product.errors.full_messages.each do |msg|
              %li= msg
      - if flash[:result] == "success" && flash[:last_action] == "update_info"
        .alert.alert-success.alert-dismissible.fade.in{:role => "alert"}
          %button.close{"aria-label" => "Close", "data-dismiss" => "alert", :type => "button"}
            %span{"aria-hidden" => "true"} ×
          Product information is stored successfully.
      - if flash[:result] == "failed" && flash[:last_action] == "update_info"
        .alert.alert-danger.alert-dismissible.fade.in{:role => "alert"}
          %button.close{"aria-label" => "Close", "data-dismiss" => "alert", :type => "button"}
            %span{"aria-hidden" => "true"} ×
          Product information is not stored successfully.
  .row{:style => 'margin-bottom: 10px;'}
    .col-md-6.col-sm-6.col-xs-12
      %h4 Primary Details
    .col-md-6.col-sm-6.col-xs-12.text-right
      = f.submit "Save", class: 'btn btn-primary'
  .form-group
    .col-md-6.col-sm-6.col-xs-12{:style => "padding-right: 0;"}  
      .row
        %label.col-md-4.col-sm-4.col-xs-12.control-label Product Name*
        .col-md-8.col-sm-8.col-xs-12.form-group
          = f.text_field :name, autofocus: true, class: 'form-control', :required => 'true', :placeholder => "Product Name"
      .row
        %label.col-md-4.col-sm-4.col-xs-12.control-label SKU*
        .col-md-8.col-sm-8.col-xs-12.form-group
          = f.text_field :sku, class: 'form-control', :required => 'true', :placeholder => "SKU"
      .row
        %label.col-md-4.col-sm-4.col-xs-12.control-label Category*
        .col-md-8.col-sm-8.col-xs-12.form-group
          = select_tag :category_name, options_from_collection_for_select(Category.all, :name, :name, (@product.category.nil?) ? '' : @product.category.name), {class: 'form-control', include_blank: true}          
      .row
        %label.col-md-4.col-sm-4.col-xs-12.control-label Product Line*
        .col-md-8.col-sm-8.col-xs-12.form-group
          = select_tag :product_line_name, options_from_collection_for_select(ProductLine.all, :name, :name, (@product.product_line.nil?) ? '' : @product.product_line.name), {class: 'form-control', include_blank: true}
      .row
        %label.col-md-4.col-sm-4.col-xs-12.control-label Brand*
        .col-md-8.col-sm-8.col-xs-12.form-group
          = select_tag :brand_name, options_from_collection_for_select(Brand.all, :name, :name, (@product.brand.nil?) ? '' : @product.brand.name), {class: 'form-control', include_blank: true}
    .col-md-6.col-sm-6.col-xs-12{:style => "padding-right: 0;"}  
      .row
        %label.col-md-4.col-sm-4.col-xs-12.control-label Product Description
        .col-md-8.col-sm-8.col-xs-12.form-group
          = f.text_area :description, class: 'form-control', :placeholder => "Product Description", rows: 10
      .row
        %label.col-md-4.col-sm-4.col-xs-12.control-label Product Image
        .col-md-8.col-sm-8.col-xs-12.form-group
          = f.file_field :image, style: 'padding-top: 7px;'
  .ln_solid
  .form-group
    .row
      .col-md-12
        %h4 Inventory Details
    .row
      .col-md-4.col-sm-6.col-xs-12
        %h5 Sales Details
        %table.info-list.selling
          %tr.selling_exclude_tax
            %td Selling Price
            %td
              = f.text_field :selling_price_ex, class: 'form-control', :required => 'true', :placeholder => "Selling Price"            
          %tr.selling_include_tax
            %td Selling Price
            %td
              = f.text_field :selling_price, class: 'form-control', :required => 'true', :placeholder => "Selling Price"            
          %tr
            %td Selling Tax
            %td
              = f.collection_select :selling_tax_id, Tax.all, :id, :short_desc, {include_blank: false}, {class: 'form-control'}
          %tr
            %td Include Tax
            %td
              = f.check_box :selling_price_type, class: 'js-switch'
      .col-md-4.col-sm-6.col-xs-12
        %h5 Purchase Details
        %table.info-list.purchase
          %tr.purchase_exclude_tax
            %td Purchase Price
            %td
              = f.text_field :purchase_price_ex, class: 'form-control', :required => 'true', :placeholder => "Purchase Price"            
          %tr.purchase_include_tax
            %td Purchase Price
            %td
              = f.text_field :purchase_price, class: 'form-control', :required => 'true', :placeholder => "Purchase Price"            
          %tr
            %td Purchase Tax
            %td 
              = f.collection_select :purchase_tax_id, Tax.all, :id, :short_desc, {include_blank: false}, {class: 'form-control'}
          %tr
            %td Include Tax
            %td 
              = f.check_box :purchase_price_type, class: 'js-switch'
      .col-md-4.col-sm-6.col-xs-12
        %h5 Inventory Details
        %table.info-list
          %tr
            %td Opening Stock Qty
            %td
              = f.text_field :quantity, class: 'form-control', :placeholder => "Opening Stock Qty"            
          %tr
            %td Re-Order Point Qty
            %td
              = f.text_field :reorder_qty, class: 'form-control', :placeholder => "Re-Order Point Qty"            
  .ln_solid
:javascript
  jQuery(document).ready(function() {    
    $('#category_name').editableSelect({ effects: 'slide' });
    $('#product_line_name').editableSelect({ effects: 'slide' });
    $('#brand_name').editableSelect({ effects: 'slide' });

    function switchSellingPrice(){
      if($('#product_selling_price_type').is(':checked')){
        $('.selling_exclude_tax').hide();
        $('.selling_include_tax').show();
      } else {
        $('.selling_exclude_tax').show();
        $('.selling_include_tax').hide();
      }    
    }

    function calculateSellingPrice(){
      var tax_string = $('#product_selling_tax_id option:selected').text();
      var tax_rate = tax_string.substring(tax_string.lastIndexOf('-') + 2, tax_string.length -1);
      if($('#product_selling_price_type').is(':checked')){
        var exclude_price = $('#product_selling_price').val()/(1 + tax_rate * 0.01);
        $('#product_selling_price_ex').val(exclude_price.toFixed(2));
      } else {
        var include_price = $('#product_selling_price_ex').val()*(1 + tax_rate * 0.01);
        $('#product_selling_price').val(include_price.toFixed(2));
      }
    }    

    switchSellingPrice();

    $('.selling .js-switch').change(function(){
      switchSellingPrice();
    });

    $('#product_selling_tax_id').change(function(){
      calculateSellingPrice();
    });

    $('#product_selling_price').change(function(){
      calculateSellingPrice();
    });

    $('#product_selling_price_ex').change(function(){
      calculateSellingPrice();
    });

    function switchPurchasePrice(){
      if($('#product_purchase_price_type').is(':checked')){
        $('.purchase_exclude_tax').hide();
        $('.purchase_include_tax').show();
      } else {
        $('.purchase_exclude_tax').show();
        $('.purchase_include_tax').hide();
      }    
    }
    switchPurchasePrice();

    function calculatePurchasePrice(){
      var tax_string = $('#product_purchase_tax_id option:selected').text();
      var tax_rate = tax_string.substring(tax_string.lastIndexOf('-') + 2, tax_string.length -1);
      if($('#product_purchase_price_type').is(':checked')){
        var exclude_price = $('#product_purchase_price').val()/(1 + tax_rate * 0.01);
        $('#product_purchase_price_ex').val(exclude_price.toFixed(2));
      } else {
        var include_price = $('#product_purchase_price_ex').val()*(1 + tax_rate * 0.01);
        $('#product_purchase_price').val(include_price.toFixed(2));
      }
    }    

    $('.purchase .js-switch').change(function(){
      switchPurchasePrice();
    });

    $('#product_purchase_tax_id').change(function(){
      calculatePurchasePrice();
    });

    $('#product_purchase_price').change(function(){
      calculatePurchasePrice();
    });

    $('#product_purchase_price_ex').change(function(){
      calculatePurchasePrice();
    });
  });